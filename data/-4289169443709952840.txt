
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="IE=Edge,chrome=1" http-equiv="X-UA-Compatible"/>
<meta content="webkit" name="renderer">
<title>西安交通大学师生综合服务大厅</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="no-cache" http-equiv="pragma"/>
<meta content="no-cache" http-equiv="cache-control"/>
<meta content="0" http-equiv="expires"/>
<script src="/EIP/resources/lib/jquery-1.12.4.min.js" type="text/javascript"></script>
<script src="/EIP/core/script/intro.js" type="text/javascript"></script>
<script src="/EIP/core/jquery-ui.min.js" type="text/javascript"></script>
<script src="/EIP/core/core.js?1553841354000" type="text/javascript"></script>
<script src="/EIP/core/boot.js?1555412936000" type="text/javascript"></script>
<script src="/EIP/resources/js/sm/service.js?1569588484000" type="text/javascript"></script>
<script src="/EIP/scripts/message/serviceUrl.js" type="text/javascript"></script>
<link href="/EIP/style/message/status.css?1553841354000" rel="stylesheet" type="text/css"/>
<link href="/EIP/core/miniui/themes/2018-skin/2018-css/index.css?1569588484000" rel="stylesheet" type="text/css"/>
<link href="/EIP/core/miniui/themes/2018-skin/2018-css/module.css?1569588484000" rel="stylesheet" type="text/css"/>
<link href="/EIP/core/custom-scrollbar/jquery.mCustomScrollbar.min.css" rel="stylesheet" type="text/css"/>
<link href="/EIP/style/transparency-design/css/transparency-design.css" rel="stylesheet" type="text/css"/>
<link href="/EIP/core/miniui/themes/2018-skin/2018-css/header-skin-1.css" id="header-skin-cssfile" rel="stylesheet" type="text/css"/>
<link href="/EIP/core/css/introjs.css" rel="stylesheet" type="text/css"/>
<script src="/EIP/core/custom-scrollbar/jquery.mCustomScrollbar.concat.min.js" type="text/javascript"></script>
<script src="/EIP/core/miniui/jquery.cookie.js" type="text/javascript"></script>
<script src="/EIP/resources/js/index/index.js?1569588484000" type="text/javascript"></script>
<script type="text/javascript">
		
			//控制门户页面上,没有内容的卡片是否自动折叠
			var navTabs = null;
            var LOGINED_WORKSPACE = {"logined_workspace":[{"url":"nonlogin/visitor/hallPage.htm","title":"服务大厅","defaultShow":true},{"url":"nonlogin/elobby/service/more.htm","title":"服务中心"},{"url":"homePage/queryHomePage.htm","title":"个人中心"},{"url":"nonlogin/queryLargeActivityList.htm?pageSize=19","title":"学校大型活动","title_en":"Large Activity","nonLoginShow":true}],"hasDesktop":1};
            var IS_LOGIN = false;
            var loginPageParam = '{id:"thirdParty",url:"https://one.xjtu.edu.cn/EIP/caslogin.jsp"}';	//跳转登录页面参数

			var isShowIndexBtn = 'true';	//获取 是否显示首页上方按钮 参数
			
			var logoutURL = 'login/logout.htm';	//获取退出系统地址
			
			var instTab = [];	//记录初始tab标签

            /* 保存当前用户看见的顶部tab页。新增角色可见权限 */
			var workspaceVisibleTabs=[];
	        /**
	         * 判断浏览器类型,是否要显示浏览器支持页面
	         * chrome、safari、IE9+的浏览器返回false,表示是支持的类型，其他的返回true表示不支持
	         */
	        function getOs(){
	            var flag = true;
	            var OsObject = window.navigator.userAgent;
	            if(OsObject.indexOf("Safari")>0){
	                flag = false;
	            }else if(OsObject.indexOf("Chrome")>0){
	                if(window.navigator.webkitPersistentStorage){
	                    flag = false;
	                }
	            }else if(OsObject.indexOf("Firefox")>0){
					flag = false;
	            }
	            if (!!window.ActiveXObject || "ActiveXObject" in window){
	          
	                if(OsObject.indexOf("MSIE")>0) {
	                    var version = OsObject.match(/MSIE \d+/i);
	                    var versionNum = version[0].match(/\d+/i);
	                    if(parseInt(versionNum) >= 9){
	                        flag = false;
	                    }
	                }else if(OsObject.toLowerCase().indexOf("trident") > -1 && OsObject.indexOf("rv") > -1){
	                    flag = false;
	                }
	            }
	
	            if(!flag){
	                flag = filterNavigatorNoSupport(OsObject);
	            }
	            return flag;
	        }
	        /**
	         * 过滤非主流浏览器
	         * @param OsObject
	         * @returns {boolean}
	         */
	        function filterNavigatorNoSupport(OsObject){
	            //搜狗 MetaSr  遨游 Maxthon QQ QQBrowser  猎豹 LBBROWSER  百度 BIDUBrowser  淘宝 TaoBrowser UC  UBrowser
	            if(OsObject.indexOf("MetaSr") > 0 || OsObject.indexOf("UBrowser") > 0 || OsObject.indexOf("Maxthon") > 0 || OsObject.indexOf("QQBrowser") > 0 || OsObject.indexOf("LBBROWSER") > 0 || OsObject.indexOf("BIDUBrowser") > 0 || OsObject.indexOf("TaoBrowser") > 0){
	                return true;
	            }
	            return false;
	        }
	
			$(function(){
				
				//撑满浏览器
				try{
					if (window != top) {
						top.location = window.location;
					}
				}catch (e) {
					console.error(e);
				}
				
				
				var personalHeight = 0;
				$(".header-skin-1").addClass('header-skin-selected');
                showLoginStatus ='false';
                if(showLoginStatus=='true'){
                    //$('#personal')[0].style.height=285+"px";
                    switchState();
                    //personalHeight = 250;
                }else{
                    $("#login-status-box").hide();
                    //$('#personal')[0].style.height=251+"px";
                    //personalHeight = 210;
                }
                
             	// 根据当前用户角色串, 判断是否显示选择角色按钮
                var roleIds = '';
                if(roleIds.indexOf(",") < 0) {
	                //$('#personal')[0].style.height=personalHeight+"px";
	                $('#roleDiv').hide();
                } 

                //根据系统参数，控制个人信息是否显示
                var isShowPersonalInfo = 'false';
                if(isShowPersonalInfo == "false"){
                	 $('#personalInfo').hide();
                }

                // 根据cookie设置语言切换显示的语言
				var enableI18n = 'false';
                if(enableI18n == 'true') $('.btn-change-language').show();

				$('.btn-change-language').click(function(){
					$.ajax({
						url: '/EIP/nonlogin/i18n/changeLanguage.htm',
						data: {language: $(this).data('language')},
						type: 'post',
						dataType: 'json',
						success: function(resp){
							if(!resp || resp.code!=200){
								mini.alert('切换语言失败');
								return;
							}

							window.location.reload();
						},
						error: function(){
							mini.alert('网络请求失败');
						}
					});
				});
			});
			
			var basePath = '/EIP/';
			var currentTab = null;
			var tabs = "";
			var tree = null;
			var serviceAppURL = EIPMS_APP_URL;
			var TIP_DEFAULT_WIDTH = 300;
			// 主页菜单栏是否显示
			var TIP_CDXS_SF = false;
			// 主页菜单按角色显示
			var TIP_CDXS_BYJS = '{"roleKeys": "teacher,student,graduate"}';
			var DEFAULT_WIDTH = {width:350,height:480}.width;
			var loginPending = false;
			var waitInterval = 0;
            var userId="";
            var roleKeys='';
            var roleId = '';
			var messageXTTimer;
			var messageGRTimer;
			(function($){
				mini.parse();
				$(window).load(function(){
					renderScrollbar();
				});
				
				$(window).resize(function(){
					renderScrollbar();
					setMainTabsHeight();
				});
			})(jQuery);
			
			function renderScrollbar() {
				var clientHeight = $(document.body)[0].clientHeight;
				var hallHeaderHeight = '80px';
				var navigatorHeight = clientHeight - (parseFloat(hallHeaderHeight)+26);
				
				$("#scrollbar").css('height', navigatorHeight);
				$("#scrollbar").mCustomScrollbar({
					autoHideScrollbar:true,
					theme:"minimal"
				});
			}
			

			/**
			 * 功能：页面初始化
			 * @author xingmin
			 * @date 2013-03-13
			 */
			$(function() {
				mini.parse();
				userId='';
				initSystemMessages('');
				initPersonalMessages('');
				tabs = mini.get("mainTabs");
				
				btnSkin();
				toggleDesign();

				tabs.maskOnLoad = false;
				tree = mini.get('leftTree');
				togglePersonal();
				headerSkin();
				//登录之前加载：服务大厅tab，服务中心tab
				reloadTabs('false');
				tabsHistory(tabs);
				//检查访问用户是否已经登录系统
				$.ajax({
					url : "/EIP/nonlogin/login/isLogin.htm",
					type : "post",
					datatype : "html",
					data : {},
					success : function(result) {
						//验证登录后要执行的操作
						if(result == 'true'){
							//已登录
							setLoginStatus(true);
							IS_LOGIN = true;
							//加载登陆后默认显示的tabs
							reloadTabs('true');
							tabClickEvent('true');
							nmNoLogin();
							isNmUser();
							menuController(TIP_CDXS_SF);
							var url = "";
							var title = "";
							var titleEn = "";
							if(url && title && url != null && url != "" && title != null && title != ""){
								top.openNewTab("/EIP/" + url, title, titleEn);
							}
							// 将头部页签状态记录到cookie中
							selectedTabsState('true');
							recordTabsState();
							// miniui-tabs History
							tabsHistory(tabs);
						}else{
							//未登录
							setLoginStatus(false);
							tabClickEvent('false');
							// 将头部页签状态记录到cookie中
							selectedTabsState('false');
						}
					},
					error : function(jqXHR, textStatus, errorThrown) {
					}
				});
				
				var userName = getCNAME();
				$('#username').val(userName);
				
				longConnect();
				
			   //获取系统参数判断是否显示换肤按钮
				var controlSkinParam = '{"showskinmenu":"","defaultcolor": "1"}';	//获取参数
				if(controlSkinParam && controlSkinParam != ""){
					var controlKey= JSON.parse(controlSkinParam);
					// var controlKey= mini.decode(controlSkinParam);
					if(controlKey.showskinmenu ==='no'){
						$('#header-skin').css('display','none');
						//隐藏换肤按钮
						$(".btn-skin").hide();	
						//设置皮肤
						setSkin(controlKey.defaultcolor);
					}
                    var cookie_skin = $.cookie("MyCssSkin");     //获取Cookie的值
                    if (!cookie_skin) {                          //如果确实存在Cookie
                        setSkin(controlKey.defaultcolor);
                    }
				}
                var cookie_des = $.cookie("isCssDesign");     //获取Cookie的值
                if($.cookie("isCssDesignLogined") != undefined) {
                	cookie_des = $.cookie("isCssDesignLogined");
                }
                var flag = false;
                //没有cookie值 用数据库默认配置
                if (cookie_des == null) {
                    //获取系统参数判断是否显示透明
                    var transparentSkin = 'true';
                    if (transparentSkin === 'true') {
                        flag = true;
                        $.cookie("isCssDesign-default", "true", { path: '/', expires: 30 });
                    }
                } else if (cookie_des === "") {
                    flag = true;
                }
                loadCssDesign(flag);//调用函数

	            /**
				 * 功能：大厅头部高度设置
				 * @author wqg
				 * @date 2019-01-04
				 */
                var hallHeaderHeight = '80px';
                // 计算登录按钮边距
                var headLoginPadding = (parseFloat(hallHeaderHeight) - 30) / 2;
                $(".login-btn").css("margin-top",headLoginPadding);
                $(".btn-change-language").css("margin-top",(parseFloat(hallHeaderHeight) - 44) / 2);
                // 设计头部侧栏开关按钮高度
                $(".header-menu-btn").css("height",hallHeaderHeight);
                // 设置头部logo容器高度
                $(".header-logo-text").css({"height":hallHeaderHeight,"line-height":hallHeaderHeight});
                // 计算头部右侧图标边距
                var headContentPadding= (parseFloat(hallHeaderHeight) - 44) / 2;
                $(".header-content").css("padding-top",headContentPadding);
                // 设置换肤下拉菜单定位
                var position = (parseFloat(hallHeaderHeight) + 14);
                $(".header-skin").css("top",position);
                $(".header-admin-box").css("top",position);

				// 针对mac下safari浏览器不能滚动在特殊处理
				if(/Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent)){
					tabs.on('activechanged', function(args){
						if(args.tab
							&& /(interaction|messageListHistory|message-personal-read|bsuService|more|hallPage)\.htm/.test(args.tab.url)
							&& tabs.getTabIFrameEl(args.tab)){
							var $body = $(tabs.getTabIFrameEl(args.tab).contentWindow.document.body);
							$body.css('paddingTop', parseInt($body.css('paddingTop')) ? 0 : 1);
						}
					})
				}
			});
			
			/**
			 *	设置皮肤
			 */
			function setSkin(defaultcolor){
				var skinUrl='header-skin-'+defaultcolor;
				if(defaultcolor=='1'){
				    switchSkin(skinUrl);
				}else if(defaultcolor=='2'){
					switchSkin(skinUrl);
				}else if(defaultcolor=='3'){
					switchSkin(skinUrl);
				}else if(defaultcolor=='4'){
					switchSkin(skinUrl);
				}else if(defaultcolor=='5'){
					switchSkin(skinUrl);
				}else if(defaultcolor=='6'){
					switchSkin(skinUrl);
				}else if(defaultcolor=='7'){
					switchSkin(skinUrl);
				}else if(defaultcolor=='8'){
					switchSkin(skinUrl);
				}
			}

			/**
			 * 根据登陆状态加载默认的tabs
			 */
			function reloadTabs(isLogin){
				workspaceVisibleTabs = [];
				var workspace = {};
				var toBeLoadedTabsObj=[];
				var toBeLoadedTabs=[];
				var dataBoardAllowRoles = 'SuperAdmin';
				var dataBoardTitle = '运行统计';
				if(isLogin == 'true'){
					workspace = mini.decode({"logined_workspace":[{"url":"nonlogin/visitor/hallPage.htm","title":"服务大厅","defaultShow":true},{"url":"nonlogin/elobby/service/more.htm","title":"服务中心"},{"url":"homePage/queryHomePage.htm","title":"个人中心"},{"url":"nonlogin/queryLargeActivityList.htm?pageSize=19","title":"学校大型活动","title_en":"Large Activity","nonLoginShow":true}],"hasDesktop":1});
					if(getCookie('isCssDesignLogined') != undefined) {
						$.cookie("isCssDesign", getCookie('isCssDesignLogined'), { path: '/', expires: 30 });
						$.cookie("isCssDesignLogined", '', { path: '/', expires: -1});
					}
					var loadTabs = workspace.logined_workspace;
					
					//控制mini的tabs显示或隐藏
					if(isShowIndexBtn == 'true'){
						var tabHtml = "<ul>";
						for(var i=0;i<loadTabs.length;i++){
							var topTab = loadTabs[i];
							if ($.isArray(topTab.roleKey)) {
							    var showFlag = false;
							    if (topTab.roleKey.length === 0) {
							        showFlag = true;
                                }
                                for (var j = 0; j < topTab.roleKey.length; j++) {
                                    if (roleKeys === topTab.roleKey[j]) {
                                        showFlag = true;
                                        break;
                                    }
                                }
                                if (!showFlag) {
                                    continue;
                                }
							}

		                    var url = topTab.url;
		                    var title = topTab.title;

		                    // 2019.04.22 国际化
		                    if(isCurrentEnglishLanguage() && topTab.title_en){
                                title = topTab.title_en;
                            }

		                    //判断是否是第三方地址，如果是第三方则根据参数target的值，进行指定链接跳转目标方式
		                  	var target = topTab.target;
		                    if(url && target && judgeUrl(url)  ){
			                    tabHtml += '<li><a href='+url+' url='+url+'  target='+target+' style=\'height:80px;line-height: 80px\'>'+title+'</a></li>';
		                    }else{
			                    tabHtml += '<li><a href="javascript:void(0)" url='+url+' style=\'height:80px;line-height: 80px\'>'+title+'</a></li>';
		                    }

		                    toBeLoadedTabsObj.push(topTab);
		                    workspaceVisibleTabs.push(topTab);

						}
						tabHtml += "</ul>";

						$(".hall-tabs").html(tabHtml);

						$(".hall-tabs").show();
					}else{
						$(".hall-tabs").hide();
						
						//渲染旧版tab
						$("#mainTabs").removeClass("mini-tabs-position");
						// 添加iframe边距
						$("#center").removeClass("clear-center-margin");
						$("#center .mini-tabs-bodys").removeClass("clear-table-body-margin");
					}
				}else if(isLogin =='nmyh'){
					workspace = mini.decode({"default_workspace": [{"url": "nonlogin/visitor/hallPage.htm","title": "服务大厅"}]});
					toBeLoadedTabsObj = workspace.default_workspace;
				}else if (isLogin == 'false') {
					workspace = mini.decode({"logined_workspace":[{"url":"nonlogin/visitor/hallPage.htm","title":"服务大厅","defaultShow":true},{"url":"nonlogin/elobby/service/more.htm","title":"服务中心"},{"url":"homePage/queryHomePage.htm","title":"个人中心"},{"url":"nonlogin/queryLargeActivityList.htm?pageSize=19","title":"学校大型活动","title_en":"Large Activity","nonLoginShow":true}],"hasDesktop":1});
					var loadTabs = workspace.logined_workspace;
					if(getCookie('isCssDesignLogined') == undefined)  {
						$.cookie("isCssDesignLogined", getCookie('isCssDesign'), { path: '/', expires: 30 });
						$.cookie("isCssDesign", "true", { path: '/', expires: 30 });
					}

					//控制mini的tabs显示或隐藏
					if(isShowIndexBtn == 'true'){
						var tabHtml = "<ul>";
						for(var i=0;i<loadTabs.length;i++){
                            var topTab = loadTabs[i];
                            if (topTab.nonLoginShow === false) {
                                continue;
                            }


		                    var url = topTab.url;
		                    var title = topTab.title;

		                    // 2019.04.22 国际化
		                    if(isCurrentEnglishLanguage() && topTab.title_en){
                                title = topTab.title_en;
                            }
		                    
		                    //判断是否是第三方地址，如果是第三方则根据参数target的值，进行指定链接跳转目标方式
		                  	var target = topTab.target;
		                    if(url && target && judgeUrl(url)  ){
			                    tabHtml += '<li><a href='+url+' url='+url+'  target='+target+' style=\'height:80px;line-height: 80px\'>'+title+'</a></li>'; 
		                    }else{
			                    tabHtml += '<li><a href="javascript:void(0)" url='+url+' style=\'height:80px;line-height: 80px\'>'+title+'</a></li>'; 
		                    }

		                    toBeLoadedTabsObj.push(topTab);
		                    workspaceVisibleTabs.push(topTab);
						}
						tabHtml += "</ul>";
						
						$(".hall-tabs").html(tabHtml);
					}else{
						$(".hall-tabs").hide();

						//渲染旧版tab
						$("#mainTabs").removeClass("mini-tabs-position");
						// 添加iframe边距
						$("#center").removeClass("clear-center-margin");
						$("#center .mini-tabs-bodys").removeClass("clear-table-body-margin");
					}
				}
				navTabs = [];
				var roleArr = dataBoardAllowRoles.split(',');
				for(var i=0; i<roleArr.length; i++){
					if(roleKeys == roleArr[i]) {
						navTabs.push({"url":"admin/dataBoard.htm","title":dataBoardTitle});
						// toBeLoadedTabsObj = navTabs.concat(toBeLoadedTabsObj);
						break;
					}
				}
				
				// 主题数据库: 判断当前角色是否具有加载指定 tab 的权限
				var dctabTitle = '数据中心概况';
				var dctabURL = '/maindatabase/dc/index.htm';
				var dctabRoles = 'dcadmin';
				for(var i = 0; i < dctabRoles.split(',').length; i++) {
					if(roleKeys == dctabRoles.split(',')[i]) {
                        navTabs.push({"url":dctabURL,"title":dctabTitle});
                       // toBeLoadedTabsObj = navTabs.concat(toBeLoadedTabsObj);
                       //  toBeLoadedTabsObj = toBeLoadedTabsObj.concat(navTabs);
                        break;
					}
				}
				toBeLoadedTabsObj = toBeLoadedTabsObj.concat(navTabs);
                navTabs = navTabs.concat(workspaceVisibleTabs);
                for(var i=0;i<toBeLoadedTabsObj.length;i++){
                    var url = toBeLoadedTabsObj[i].url;
                    
                    //第三方地址tab不显示
                    if(url && judgeUrl(url) ){
                    	continue;
					}else{
						url = '/EIP/' + url;
					}
                    
                    var title = toBeLoadedTabsObj[i].title;
                    var id = toBeLoadedTabsObj[i].id != undefined ? toBeLoadedTabsObj[i].id : toBeLoadedTabsObj[i].title;
					
					var tab = {};
					tab.id = id;
					tab.name = title;
					tab.title = "<a title="+title+">" + title + "</a>";
					tab.showCloseButton = false;
					tab.url =  url;
					tab.headerCls="removetab-first";
					toBeLoadedTabs.push(tab);
					
					instTab.push(tab);

				}
				tabs.removeAll();
				tabs.setTabs(toBeLoadedTabs);
				tabs.activeTab(0);
				
				if(isShowIndexBtn == 'true'){ 
					tabs.on("activechanged",hideMiniTab);
				}
				
                if(LOGINED_WORKSPACE.hasDesktop == 1) {
                    mini.get("mainTabs").onActiveChanged(function(e) {
                        if(e.tab != undefined) {
                            if(e.tab.loadedUrl != undefined && e.tab.loadedUrl.indexOf('desktop/index.htm') != -1 ) {
                                if(getCookie('refreshDeskTop') == 'true') {
                                    mini.get("mainTabs").reloadTab( mini.get("mainTabs").getTab('我的桌面'));
                                    var exdate=new Date()
                                    exdate.setDate(exdate.getDate()+1)
                                    document.cookie="refreshDeskTop=false;expires="+exdate.toGMTString() + ";path=/";
                                }
                            }

                        }
                    })
                }
                mini.get("mainTabs").onActiveChanged(function(e) {
                    if(e.tab != undefined) {
                        if(e.tab.url.indexOf("admin/dataBoard.htm") != -1 || e.tab.url.indexOf('maindatabase/dc/index.htm') != -1) {
                            $('#topBox').css('cssText', " background:url(/EIP//style/transparency-design/img/skin-dark-blue.png) no-repeat !important;" +
                                "background-size: cover !important;" +
                                "filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='../../../style/transparency-design/img/skin-dark-blue.png',sizingMethod='scale');");
                        } else {
                            $('#topBox').css('background', '');
                        }
                              
                        var $a = "";
                        
                        //判断登录后工作台 是否包含 当前活动tab标签,如果包含，则选中
                        var lists = mini.decode(LOGINED_WORKSPACE);
                        var workSpaceList = lists.logined_workspace;
                        for(var i=0,len=workSpaceList.length; i<len; i++){
							if(e.tab.url.indexOf(workSpaceList[i].url) != -1 ){
								$a = $(workSpaceList[i]);
								break;
							}
		                }
                        
                        //根据活动tab控制跳转新版tab页签
                        if(isShowIndexBtn == 'true'){
                        	if(e.tab.url.indexOf("nonlogin") == -1 
                        			&& e.tab.url.indexOf("nonlogin/elobby/service/more") == -1 
                        			&& e.tab.url.indexOf("nonlogin/visitor/hallPage") == -1 ) {
                        		
                        		var tabsArr = tabs.tabs;
                        		var tempArr = [];
                        		
                        		//var $a = "";
                    			$(".hall-tabs li").each(function(index){
            						var a = $(this).find("a").get(0);
            						if(a && a.attributes.url && a.attributes.url.value){
            							var aURL = a.attributes.url.value;
            							
            							//判断是否是第三方地址(此处不判断，就会把第三方的tab删除掉)
            	                    	if(aURL && !judgeUrl(aURL)){
            	                    		
            	                    		//登录状态
                							if(IS_LOGIN == true){
                								if(aURL.indexOf("nonlogin") == -1 
                                            			&& aURL.indexOf("nonlogin/elobby/service/more") == -1 
                                            			&& aURL.indexOf("nonlogin/visitor/hallPage") == -1 ) {
                    								if(!$a){
        	            								$a = $(a);
                    								}
                    							}else{
                    								//将含有if条件判断中的链接地址的tab删除
                    								for(var i=0,len=tabsArr.length; i<len; i++){
                    									if(tabsArr[i].url.indexOf(aURL) != -1 ){
                    					                	tempArr.push(tabsArr[i]);
                    									}
                    				                }
                    							} 
                							}else{
                								if(aURL.indexOf("nonlogin") == -1 
                                            			&& aURL.indexOf("nonlogin/elobby/service/more") == -1 
                                            			&& aURL.indexOf("nonlogin/visitor/hallPage") == -1 ) {
                    								if(!$a){
        	            								$a = $(a);
                    								}
                    							}
                   								//将含有if条件判断中的链接地址的tab删除
                   								for(var i=0,len=tabsArr.length; i<len; i++){
                   									if(tabsArr[i].url.indexOf(aURL) != -1 ){
                   					                	tempArr.push(tabsArr[i]);
                   									}
                   				                }
                    							
                							}
            	                    	}
            						}
            					});
                    			if($a){
            						$a.addClass("hall-tabs-active");
            						$a.parent("li").siblings("li").find("a").removeClass("hall-tabs-active");
            					}
                    			
                    			//删除‘服务大厅’、‘服务中心’tab页签
                    			for(var i=0,len=tempArr.length; i<len; i++){
                    				//tabs.removeTab(tempArr[i]);
									tempArr[i].visible = false;
									tabs.updateTab(tempArr[i])
				                }
                        	}
                        		
                        }                                   
                    }else{//tab = undefined
                    	//没有登录
                    	if(IS_LOGIN == false){
                    		//显示上方页签
                    		if(isShowIndexBtn == 'true'){
                    			var tabsArr = tabs.tabs;
            					if(tabsArr.length < 1){		//不存在tab标签的情况
            						//循环判断
                					var $a = "";
                        			$(".hall-tabs li").each(function(index){
                						var a = $(this).find("a").get(0);
                						if(a && a.attributes.url && a.attributes.url.value){
                							var aURL = a.attributes.url.value;
                							if(aURL.indexOf("nonlogin") != -1 
                                        			|| aURL.indexOf("nonlogin/elobby/service/more") != -1 
                                        			|| aURL.indexOf("nonlogin/visitor/hallPage") != -1 ) {
                								if(!$a){
    	            								$a = $(a);
                								}
                							}
                						}
                					});
                        			if($a){
                						$a.addClass("hall-tabs-active");
                						$a.parent("li").siblings("li").find("a").removeClass("hall-tabs-active");
                						
                						//将'服务大厅'或'服务中心'tab添加到tabs列表中，呈活动状态
                						var aURL = $a[0].attributes.url.nodeValue;
                						for(var i=0,len=instTab.length; i<len; i++){
                							if(instTab[i].url.indexOf(aURL) != -1){
                								tabs.addTab(instTab[i]);
                								tabs.activeTab(instTab[i]);
                								break;
                							}
                						}
                					}
            					}
                    		}else{	//不显示上方页签
                    			var activeTab = tabs.getActiveTab();
                    			if(activeTab.url.indexOf("nonlogin") == -1 
                            			&& activeTab.url.indexOf("nonlogin/elobby/service/more") == -1 
                            			&& activeTab.url.indexOf("nonlogin/visitor/hallPage") == -1 ) {
                    				
                    				for(var i=0,len=instTab.length; i<len; i++){
                    					if(instTab[i].url.indexOf("nonlogin") != -1 
                                    			|| instTab[i].url.indexOf("nonlogin/elobby/service/more") != -1 
                                    			|| instTab[i].url.indexOf("nonlogin/visitor/hallPage") != -1 ) {
            								tabs.activeTab(instTab[i]);
            								break;
            							}
            						}
                    			}
                    		}	
                        } else {
                    	    /* 存在已经登录情况下，关闭tab页时，默认显示关闭页左边的tab页。当左边为运行统计/数据中心概况时，
                    	    由于这两个tab页背景颜色固定，所以必须增加判断，动态添加样式 */
                    	    var tabArr = e.sender.getTabs();
                    	    if (tabArr.length > 0) {
                    	        var tab = tabArr[tabArr.length - 1];
                                if(tab.url.indexOf("admin/dataBoard.htm") != -1 || tab.url.indexOf('maindatabase/dc/index.htm') != -1) {
                                    $('#topBox').css('cssText', " background:url(/EIP//style/transparency-design/img/skin-dark-blue.png) no-repeat !important;" +
                                        "background-size: cover !important;" +
                                        "filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='../../../style/transparency-design/img/skin-dark-blue.png',sizingMethod='scale');");
                                }
                            }
                        }
                    }//tab = undefined  	
                })
			}
			/**
			 * 门户各窗口重新加载方法注册到首页
			 * @param moduleCode 模块编号
			 * @param reloadFuntion 重载窗口方法
			 * @author jiashaofei
			 * @date 2013-12-09
			 */
			function portalReloadRegister(moduleCode, reloadFuntion) {
				if (!window.protalReloadFunctions) {
					window.protalReloadFunctions = {};
				}
				window.protalReloadFunctions[moduleCode] = reloadFuntion;
			}

			/**
			 * 门户窗口重新加载
			 * @param moduleCode 模块编号
			 * @author jiashaofei
			 * @date 2013-12-09
			 */
			function portalReload(moduleCode) {
				if (window.protalReloadFunctions) {
					var func = window.protalReloadFunctions[moduleCode];
					if (func) {
						func();
					}
				}
			}

			//写cookies
			function setCookie(name, value, path) {
				var Days = 30;
				var exp = new Date();
				exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
				var cookie = name + "=" + escape(value) + ";expires="
						+ exp.toGMTString();
				if (path) {
					cookie += ";path=" + path;
				}
				document.cookie = cookie;
			}
			
			/**
			 * 功能：显示或隐藏换肤菜单
			 * @author wqg
			 * @date 2018-07-09
			 */
			function btnSkin(){
				var hallHeaderHeight = '80px';
					hallHeaderHeight = parseInt(hallHeaderHeight);
				$(".btn-skin").hover(function(){
					$(".header-skin").stop().show().animate({
						"top":hallHeaderHeight,
						"opacity":"1"
					},200).css({
						"flter": "Alpha(Opacity=100)"
					});
				},function(){
					$(".header-skin").stop().animate({
						"top":hallHeaderHeight + 16,
						"opacity":"0"
					},200,function(){
						$(".header-skin").hide();
					}).css({
						"flter": "Alpha(Opacity=0)"
					});
	            });
				
				$(".header-skin").hover(function(){
					$(".header-skin").stop().show().css({
						"top": hallHeaderHeight,
						"opacity":"1"
					});
				},function(){
					$(".header-skin").stop().animate({
						"top":hallHeaderHeight + 16,
						"opacity":"0"
					},200,function(){
						$(".header-skin").hide();
					}).css({
						"flter": "Alpha(Opacity=0)"
					});
	            });
			}

			/**
			 * 功能：显示或隐藏个人中心窗口
			 * @author wqg
			 * @date 2018-07-09
			 */
			function togglePersonal() {
				var hallHeaderHeight = '80px';
					hallHeaderHeight = parseInt(hallHeaderHeight);
				$(".header-content-personal").hover(function() {
					$(".header-admin-box").stop().show().animate({
						"top": hallHeaderHeight,
						"opacity":"1"
					},200).css({
						"flter": "Alpha(Opacity=100)"
					});
				}, function() {
					$(".header-admin-box").stop().animate({
						"top": hallHeaderHeight + 14,
						"opacity":"0"
					},200,function(){
						$(".header-admin-box").hide();
					}).css({
						"flter": "Alpha(Opacity=0)"
					});
				});

				$(".header-admin-box").hover(function() {
					$(".header-admin-box").stop().show().css({
						"top": hallHeaderHeight,
						"opacity":"1"
					});
				}, function() {
					$(".header-admin-box").stop().animate({
						"top": hallHeaderHeight + 14,
						"opacity":"0"
					},200,function(){
						$(".header-admin-box").hide();
					}).css({
						"flter": "Alpha(Opacity=0)"
					});
				});
			}
			
			/**
			 * 门户透明UI和其他tab切换
			 * 2017-10-24
			 */
			function transparencyDesignBg(){
				if(tabs){
					var tabObj = tabs.getActiveTab();
					if(tabObj && (tabObj.url.indexOf("infoPortal/infoPortal.htm") != -1 || 
							tabObj.url.indexOf("homePage/queryHomePage.htm") != -1 ||
							tabObj.url.indexOf("elobby/service/more.htm") != -1 ||
							tabObj.url.indexOf("elobby/service/introduction") != -1 ||
							tabObj.url.indexOf("nonlogin/visitor/hallPage.htm") != -1 ||
							tabObj.url.indexOf("desktop/index.htm") != -1)){
							$("#transparency-design-cssfile").attr("href", basePath + "style/transparency-design/css/transparency-design" + ".css"); 
					}else{
							$("#transparency-design-cssfile").attr("href", ""); 
					}
				}
			}
			
			/**
			 * 切换门户UIcss
			 */
			function toggleDesign() {
				var $btn_toggle = $(".btn-toggle");  //新版旧版按钮
				// 判断浏览器，如果不支持透明皮肤则设置isCssDesign为true，
				// 同时禁用新版旧版切换按钮
				if(getOs()){
					// 浏览器不支持
					$.cookie("isCssDesign", "true", { path: '/', expires: 30 });
					$btn_toggle.click(function () {   
				    	alert('您的浏览器不支持当前主题，为了您的优质体验，推荐您用支持的浏览器，chrome、360极速、IE9以上等');
				    });
				}else{
					// 浏览器支持
					$btn_toggle.click(function () {   
				    	var cookie_des = $.cookie("isCssDesign");     //获取Cookie的值
				    	onEventDesign(cookie_des);//调用函数
				    	toggleIframeDesign($(document));
				    });
				}
				
			    //保存Cookie完毕以后就可以通过Cookie来获取当前的是否为旧版，默认为空为新版
			    // var cookie_des = $.cookie("isCssDesign");     //获取Cookie的值
			    // onEventDesign(!cookie_des);     //执行
			}
			
			function toggleIframeDesign($doc){
				var tabsBodys = $doc.find("iframe");
			    tabsBodys.each(function(){
			    	try{
				    	var frame = $(this).contents();
				    	this.contentWindow.eipDesignThemes && this.contentWindow.eipDesignThemes();	    	
				    	frame.find('iframe').length && toggleIframeDesign($(this.contentWindow.document));
			    	}catch(e){}
			    });
			}

			/**
			 * 切换门户UI
			 */
			function onEventDesign(flag){
				if(tabs){
					var onActiveFunc = function(){
						var tabObj = tabs.getActiveTab();
						var $indexDesignCss = $("head").find("#indexDesignCss");
                        var hasClass = $(".btn-toggle").hasClass("btn-toggle-old");
                    	if(tabObj && (tabObj.url.indexOf("admin/dataBoard.htm") != -1 || tabObj.url.indexOf('maindatabase/dc/index.htm') != -1)) {
                            !$indexDesignCss.length && $("head").append('<link id="design_css" rel="stylesheet" type="text/css" href="/EIP/style/transparency-design/css/transparency-design.css"/>');
                            $(".btn-toggle-title").show();
                            $("#topBox").addClass("transparency-design");
                            if(flag || (flag === null && !hasClass)) {
                                $.cookie("isCssDesign", '', { path: '/', expires: 30 });  //保存Cookie
                                $(".btn-toggle").removeClass("btn-toggle-new");
                                $(".btn-toggle").addClass("btn-toggle-old");  //返回旧版
                            } else {
                                $.cookie("isCssDesign", "true", { path: '/', expires: 30 });  //保存Cookie
                                $(".btn-toggle").removeClass("btn-toggle-old");
                                $(".btn-toggle").addClass("btn-toggle-new");  //返回新版
                            }
                        } else if(flag || (flag === null && !hasClass)){
							if(tabObj && (tabObj.url.indexOf("infoPortal/infoPortal.htm") != -1 
									|| tabObj.url.indexOf("homePage/queryHomePage.htm") != -1 
									|| tabObj.url.indexOf("bsu/service/bsuService.htm") != -1
									|| tabObj.url.indexOf("elobby/service/more.htm") != -1
									|| tabObj.url.indexOf("elobby/service/introduction") != -1
									|| tabObj.url.indexOf("nonlogin/visitor/hallPage.htm") != -1
									|| tabObj.url.indexOf("desktop/index.htm") != -1
									)){
									!$indexDesignCss.length && $("head").append('<link id="design_css" rel="stylesheet" type="text/css" href="/EIP/style/transparency-design/css/transparency-design.css"/>');
									$(".btn-toggle-title").show();
									$("#topBox").addClass("transparency-design");
									
							}  else{
								$indexDesignCss.remove();
								$("#topBox").removeClass("transparency-design");
								$("#browserTips").hide();
								$(".browser-tip").hide();
							}
							$.cookie("isCssDesign", '', { path: '/', expires: 30 });  //保存Cookie
							$(".btn-toggle").removeClass("btn-toggle-new");
							$(".btn-toggle").addClass("btn-toggle-old");  //返回旧版

						}else{
							$indexDesignCss.remove();
							$("#topBox").removeClass("transparency-design");
							$.cookie("isCssDesign", "true", { path: '/', expires: 30 });  //保存Cookie
							$(".btn-toggle").removeClass("btn-toggle-old");
							$(".btn-toggle").addClass("btn-toggle-new");  //返回新版
						}
					};
					tabs.on("activechanged",onActiveFunc);
					onActiveFunc();
            }
            }
            /**
             * 加载门户UI
			 * flag : true 为透明皮肤
             */
            function loadCssDesign(flag){
                if(tabs){
                    var onActiveFunc = function(){
                        var tabObj = tabs.getActiveTab();
                        var $indexDesignCss = $("head").find("#indexDesignCss");
                        if(tabObj && (tabObj.url.indexOf("admin/dataBoard.htm") != -1 || tabObj.url.indexOf('maindatabase/dc/index.htm') != -1)) {
                            !$indexDesignCss.length && $("head").append('<link id="design_css" rel="stylesheet" type="text/css" href="/EIP/style/transparency-design/css/transparency-design.css"/>');
                            $(".btn-toggle-title").show();
                            $("#topBox").addClass("transparency-design");
                        } else if(flag){
                            if( IS_LOGIN  && tabObj && (tabObj.url.indexOf("infoPortal/infoPortal.htm") != -1
                                || tabObj.url.indexOf("homePage/queryHomePage.htm") != -1
                                || tabObj.url.indexOf("bsu/service/bsuService.htm") != -1
                                || tabObj.url.indexOf("elobby/service/more.htm") != -1
                                || tabObj.url.indexOf("elobby/service/introduction") != -1
                                || tabObj.url.indexOf("nonlogin/visitor/hallPage.htm") != -1
                                || tabObj.url.indexOf("desktop/index.htm") != -1
                                )){
                                !$indexDesignCss.length && $("head").append('<link id="design_css" rel="stylesheet" type="text/css" href="/EIP/style/transparency-design/css/transparency-design.css"/>');
                                $(".btn-toggle-title").show();
                                $("#topBox").addClass("transparency-design");

                            } else{
                                $indexDesignCss.remove();
                                $("#topBox").removeClass("transparency-design");
                                $("#browserTips").hide();
                                $(".browser-tip").hide();
                            }
                            $(".btn-toggle").removeClass("btn-toggle-new");
                            $(".btn-toggle").addClass("btn-toggle-old");  //返回旧版

                        }else{
                            $indexDesignCss.remove();
                            $("#topBox").removeClass("transparency-design");
                            $(".btn-toggle").removeClass("btn-toggle-old");
                            $(".btn-toggle").addClass("btn-toggle-new");  //返回新版
                        }
                    };
                    tabs.on("activechanged",onActiveFunc);
                    onActiveFunc();
                }
            }

            function switchRole() {
                top.onSwitchRoles();
            }

            function editPassword() {
                top.changePassword();
            }

            //标记 用户在线状态
            function switchState(){
                $('.header-admin-onlinezt-inherit').on('click', function(){
                    var classNames = this.className.split('-');
                    var className = classNames[classNames.length - 1];

                    $('.header-admin-onlinezt-inherit').removeClass('header-admin-onlinezt-online header-admin-onlinezt-invisible header-admin-onlinezt-offline header-admin-onlinezt-busy');
                    $(this).addClass('header-admin-onlinezt-' + className);

                    top.EIPMessageService.changeOnlineStatus(className);
                });
            }

            function openPersonalnformation() {
                var url = '/EIP/user/personalInfoManage/personalInfoManage.htm';
                top.openNewTab(url, '个人信息管理', '个人信息管理');
            }

            function groupManagement() {
                var url = '/EIP/group/group.htm';
                top.openNewTab(url, '个人群组管理', '个人群组管理');
            }

            function openDesktopMgr() {
                var tab = top.tabs.getTab(0);
                var frame = top.tabs.getTabIFrameEl(tab);
                frame.contentWindow.onAddPortal(0);
            }

            function openPersonalPortal() {
                var url = '/EIP/personal/personalCenter.htm';
                top.openNewTab(url, '个人数据中心', '个人数据中心');
            }

            /**
             * 功能：恢复初始设置
             * @author xingmin
             * @date 2013-05-07
             */
            function onResetPortal(type){
            	//根据参数判断 具体恢复的初始桌面是‘服务门户’还是‘信息门户’ 0表示服务门户，2表示信息门户
            	var typeParam = '0';
            	if(typeParam == '0' || typeParam == '2'){
            		type = typeParam;
            	}
            	
                parent.mini.showMessageBox({
                    title: "提示",
                    width: 250,
                    iconCls: "mini-messagebox-question",
                    buttons: ["确定", "取消"],
                    message: "确定要恢复初始设置?",
                    callback: function (action) {
                        if(action=="确定"){
                            onSubmit(
                                basePath+"/homePage/resetInitPortal.htm",
                                "post",
                                {portalType:type},
                                true,
                                function(){
                                    onReloadPortal();
                                }
                            );
                        }
                    }
                });
            }
            /**
             * 功能：右键刷新
             * @author xingmin
             * @date 2013-05-07
             */
            function onReloadPortal(){
                var tabs = parent.tabs;
                //tabs.reloadTab(tabs.getTab("个人主页"));
                var param = '个人主页';
                if(param){
                    //tabs.getTab(param);
                    tabs.reloadTab(tabs.getTab(param));
                }
            }

            /**
             * 获取新个人消息数量
             */
            function getMessageCount() {
                return $('#messageCount').text();
            }

		/**
		 * 功能：当前页面如果是首页、服务大厅页面时隐藏miniui的tabs
		 * date: 2019.01.23
		 * name: wqg
		 */
		function hideMiniTab() {
			if(tabs){
				var tabObj = tabs.getActiveTab();
				if(tabObj){
					var title = tabObj.title;
					var $a = "";
					$(".hall-tabs li").each(function(index){
						var a = $(this).find("a").get(0);
						if(a && title.indexOf(a.innerHTML) != -1){
							$a = $(a);
						}
					});
					if(tabObj && (tabObj.url.indexOf("nonlogin/visitor/hallPage.htm") != -1 ||
						tabObj.url.indexOf("nonlogin") != -1 )){
						$("#mainTabs").addClass("mini-tabs-position");
						// 清除iframe边距
						$("#center").addClass("clear-center-margin");
						$("#center .mini-tabs-bodys").addClass("clear-table-body-margin");
					}else if(tabObj && (tabObj.url.indexOf("elobby/service/more.htm") != -1)){
						$("#mainTabs").addClass("mini-tabs-position");
						// 清除iframe边距
						$("#center").addClass("clear-center-margin");
						$("#center .mini-tabs-bodys").addClass("clear-table-body-margin");
					}else{
						$("#mainTabs").removeClass("mini-tabs-position");
						$("#center").removeClass("clear-center-margin");
						$("#center .mini-tabs-bodys").removeClass("clear-table-body-margin");
					}
					if($a){
						$a.addClass("hall-tabs-active");
						$a.parent("li").siblings("li").find("a").removeClass("hall-tabs-active");
					}
				}
			}	
			setMainTabsHeight();
		}

		// 获取并设置mainTabs的高度值及页面的宽度
		function setMainTabsHeight(){	
			setTimeout(function(){
				var windowH = $("#center").height();
				if(tabs){
					var tabObj = tabs.getActiveTab();
					if(tabObj && (tabObj.url.indexOf("nonlogin/visitor/hallPage.htm") != -1 ||
					   tabObj.url.indexOf("nonlogin") != -1 ||
					   tabObj.url.indexOf("elobby/service/more.htm") != -1
					)){
						$("#mainTabs").outerHeight(windowH + 31);
						var centerW;
						if($("#west").css("display") == "none"){
							centerW = $("#topBox").outerWidth();
						}else{
							centerW = $("#topBox").outerWidth() - 230;
						}
						$("#center").css({"width":centerW,"padding":"0"});
						$("#center .mini-tabs-table .mini-tabs-bodys").css({"width":centerW,"height":windowH,"padding":"0"});
						$("#center .mini-tabs-table .mini-tabs-body").css({"height":windowH});
					}else{
						$("#mainTabs").outerHeight(windowH);
						var centerW = $("#center").outerWidth() - 20;
						$("#center").css({"width":centerW,"padding":"5px 10px 0"});
						$("#center .mini-tabs-table .mini-tabs-bodys").css({"width":centerW-10,"height":windowH-40,"padding":"5px"});
						$("#center .mini-tabs-table .mini-tabs-body").css({"height":windowH-40});
					}
				}
			},500);
		}

		/**
		 * 页面当前是否设置为英文
		 * @returns {boolean}
		 */
		function isCurrentEnglishLanguage(){
			return getCookie('htLanguage') == 'en_US'
		}

		// 头部导航click事件
		function tabClickEvent(loginStatus){
			var workspaceArr1 = mini.clone(workspaceVisibleTabs);
			var basePath = "/EIP/";
			
			// 登录状态
			if(loginStatus == "true"){
				$(".hall-tabs li").each(function(index){
					$(this).find("a").click(function(){
						var index = $(this).parent("li").index();
						
						var url = workspaceArr1[index].url;
		                var title = workspaceArr1[index].title
		                var id = workspaceArr1[index].id

						// 2019.04.22 国际化
						if(isCurrentEnglishLanguage() && workspaceArr1[index].title_en){
							title = workspaceArr1[index].title_en;
						}

		                var tab = {};
						tab.id = index;
						tab.name = title;
						tab.title = "<a title="+title+">" + title + "</a>";
						tab.showCloseButton = false;
						
						
						if(url && judgeUrl(url) ){
							var target = workspaceArr1[index].target;
							tab.url =  url;
							if(target){
								return;
							}
						}else{
							tab.url = '/EIP/' + url;
						}
						
						tab.headerCls="removetab-first";
		                
		              	//设置表头按钮样式以及页面中显示数据
		                if(url.indexOf("nonlogin") != -1 
		                		|| url.indexOf("nonlogin/elobby/service/more") != -1 
		                		|| url.indexOf("nonlogin/visitor/hallPage") != -1 ){
		                	var tempArr = [];
							tempArr.push(tab);
							
							var tabsArr = tabs.tabs;
							/* for(var i=0,len=tabsArr.length; i<len; i++){
								if(tabsArr[i].url.indexOf(url) == -1){
				                	tempArr.push(tabsArr[i]);
								}
			                }
							tabs.setTabs(tempArr);
		    				tabs.activeTab(0); */
							
		    				//隐藏mini的tab
							$("#mainTabs").addClass("mini-tabs-position");
							// 清除iframe边距
							$("#center").addClass("clear-center-margin");
							$("#center .mini-tabs-bodys").addClass("clear-table-body-margin");
		                }else{
		                	var tabsArr = tabs.tabs;
		                	var workStr = mini.encode(workspaceArr1);
		                	
		                	var tempArr = [];
							tempArr.push(tab);

							//整合tabs列表显示数据(除了点击的tab外，不包含登录后工作台参数中其余tab)
		                	/* for(var i=0,len=tabsArr.length; i<len; i++){
	                			var tabUrl = tabsArr[i].url;
			                	tabUrl = tabUrl.substring(basePath.length,tabUrl.length);
			                	if(workStr.indexOf(tabUrl) == -1){
			                		tempArr.push(tabsArr[i]);
			                	}
			                }
		                	tabs.removeAll();
		                	tabs.setTabs(tempArr);
		    				tabs.activeTab(0); */
		    				for(var i = 0, len = tabsArr.length; i < len; i++) {
		    					var tabUrl = tabsArr[i].url;
		    					if(tabUrl.indexOf("nonlogin") != -1 
				                		|| tabUrl.indexOf("nonlogin/elobby/service/more") != -1 
				                		|| tabUrl.indexOf("nonlogin/visitor/hallPage") != -1 ){
		    						tabsArr[i].visible = false;
		    						tabs.updateTab(tabsArr[i]);
		    					}
		    				}
		    				
		    				//显示mini的tab
							$("#mainTabs").removeClass("mini-tabs-position");
							// 清除iframe边距
							$("#center").removeClass("clear-center-margin");
							$("#center .mini-tabs-bodys").removeClass("clear-table-body-margin");
		                }
		                var tabsArr = tabs.tabs;
						for(var i = 0, len = tabsArr.length; i < len; i++) {
	    					if(tabsArr[i].url.indexOf(url) != -1){
	    						tabsArr[i].visible = true;
	    						tabs.updateTab(tabsArr[i]);
	    						tabs.activeTab(i);
	    						break;
							}
	    				}
					});
					
				});
			// 未登录状态
			}else if(loginStatus == "false"){
				$(".hall-tabs li").each(function(index){
					$(this).find("a").click(function(){
						
						var index = $(this).parent("li").index();
						
						var url = workspaceArr1[index].url;
		                var title = workspaceArr1[index].title
		                
		                var tab = {};
						tab.id = title;
						tab.name = title;
						tab.title = "<a title="+title+">" + title + "</a>";
						tab.showCloseButton = false;
						
						
						//判断是否是第三方地址
						if(url && judgeUrl(url)  ){
							var target = workspaceArr1[index].target;
							tab.url =  url;
							if(target){
								return;
							}else{
								tabs.removeAll();
								var tempArr = [];
								tempArr.push(tab);
								tabs.setTabs(tempArr);
								tabs.activeTab(tab); 
								
								/* var $a = $(this);
								if($a){
									$a.addClass("hall-tabs-active");
									$a.parent("li").siblings("li").find("a").removeClass("hall-tabs-active");
								} */
								return;
							}
						}else{
							tab.url = '/EIP/' + url;
						}
						tab.headerCls="removetab-first";
						
						//因tab变动时，删除了‘服务大厅’，‘服务中心’，故再次点击上述卡片时，需要添加到tabs列表中
						var tabsArr = tabs.tabs;
						var tempArr = [];
						tempArr.push(tab);
						
						/* for(var i=0,len=tabsArr.length; i<len; i++){
							if(tabsArr[i].url.indexOf(url) == -1){
			                	tempArr.push(tabsArr[i]);
							}
		                }
						tabs.setTabs(tempArr); */
						
		                //根据点击tab页签判断是否登陆
		                var flag = "true";
		                var tabsArr = tabs.tabs;
		                for(var i=0,len=tabsArr.length; i<len; i++){
		                	var tabUrl = tabsArr[i].url; 
		                	if(tabUrl.indexOf(url) != -1 
		                			&& (tabUrl.indexOf("nonlogin") != -1 
		                					|| tabUrl.indexOf("nonlogin/elobby/service/more") != -1 
		                					|| tabUrl.indexOf("nonlogin/visitor/hallPage") != -1 )){
		                		tabs.activeTab(i);
		                		flag = "false";
		                		hideMiniTab();
		                		break;
		                	}
		                }
		                if(flag == "true"){
		                	if(loginPageParam){
		        				var loginPageParamObj = mini.decode(loginPageParam);
		        				if(loginPageParamObj.id && loginPageParamObj.url){
		        					var paramId = loginPageParamObj.id;
		        					if(paramId == "eip"){
		        						window.location = basePath+loginPageParamObj.url;
		        					}else if(paramId == "thirdParty"){
		        						window.location = loginPageParamObj.url;
		        					}else{
		        						window.location = basePath+"nonlogin/login/login.htm";
		        					}
		        				}else{
		        					window.location = basePath+"nonlogin/login/login.htm";
		        				}
		        			}else{
		        				window.location = basePath+"nonlogin/login/login.htm";
		        			}
		                }
					});
				});
			}
		}
		
		/**
		 * 判断url地址 是否是第三方地址
		 */
		function judgeUrl(url){
			//if(url.startsWith("http://") || url.startsWith("https://")){
			if(url.indexOf("http://") ==0 || url.indexOf("https://") == 0){
				return true;
			}
			return false;
		}
		
		
		// 获取系统参数中登录/未登录工作台的索引
		function getTabIndex(workspaceArr,urlStr){
			for(var i = 0;i < workspaceArr.length; i++){
				if(workspaceArr[i].url.indexOf(urlStr) != -1){
					return i;
				}
			}
		}

		/**
		 * 功能： 
		 * 		1、登录成功后默认加载信息中心页或服务中心页
		 *		2、刷新时记录当前选中的头部导航页签
		 * @author wqg
		 * @date 2019-04-10
		 */
		function selectedTabsState(isLogin){
			// 190821 注释: navTabs 和 tabs 的顺序不一致, 根据navTabs 索引加载 tabs, 结果有误			
			// 登录成功后默认加载信息中心页或服务中心页	
			/* for(var i = 0; i < navTabs.length; i++){
				if(navTabs[i].url.indexOf('homePage/queryHomePage.htm') != -1 ||
				   navTabs[i].url.indexOf('infoPortal/infoPortal.htm') != -1 ){
					var tabsIndexValue = i;
				}
			} */
			// 190821 新增: 根据系统参数配置, 显示指定 li
			var showDefaultURL = "";
			for(var i = 0; i < workspaceVisibleTabs.length; i++) {
				if(workspaceVisibleTabs[i].defaultShow != undefined && workspaceVisibleTabs[i].defaultShow == true) {
					showDefaultURL = workspaceVisibleTabs[i].url;
					break;
				}
			}
			var copyTabs = tabs.tabs;
			var showDefaultIndex = -1;
			for(var i = 0; i < copyTabs.length; i++) {
				if(copyTabs[i].url.indexOf('homePage/queryHomePage.htm') != -1 ||
						copyTabs[i].url.indexOf('infoPortal/infoPortal.htm') != -1 ){
					var tabsIndexValue = i;
				}
				if(copyTabs[i].url.indexOf(showDefaultURL) != -1) {
					showDefaultIndex = i;
				}
			}

			// 刷新时记录当前选中的头部导航页签
			if(isLogin == 'true'){
				// 页面刷新时，获取cookie中tab选中的索引值，加载相应的tab
				var getTabsIndexValue = $.cookie("selectedTabsState");
				if(getTabsIndexValue != undefined){						
					if(tabsIndexValue != undefined){
						tabs.activeTab(parseInt(getTabsIndexValue));
					} else {
						tabs.activeTab(0);
					} 	
				} else {
					if(showDefaultIndex != -1) {
						tabs.activeTab(showDefaultIndex);
					} else {
						tabs.activeTab(tabsIndexValue);
					}
				}
			} else {
				// 未登录时清除cookie记录
				$.cookie("selectedTabsState", tabsIndexValue, { path: '/', expires: -1 });
			}
		}
		// 点击头部导航时记录当前选中的tab页签索引
		function recordTabsState(){
			setTimeout(function(){
				tabs.on('activechanged',function(){
					// 获取当前选中的tab面板
					var tabsActive = tabs.getActiveTab();
					if(tabsActive){
						if(!isNaN(tabsActive.id)){
							$.cookie("selectedTabsState", tabsActive.id, { path: '/', expires: 0.35 });
						} else {
							var loginWorkbenchArr = mini.clone(workspaceVisibleTabs);
							// 获取当前面板在默认登录后工作台中的索引
							for(var i = 0; i < loginWorkbenchArr.length; i++){
								if(loginWorkbenchArr[i].url.indexOf('nonlogin/visitor/hallPage.htm') != -1){
									var hallPageIndex = i;
								} else if (loginWorkbenchArr[i].url.indexOf('nonlogin/elobby/service/more') != -1){
									var moreServicesIndex = i;
								} else if (loginWorkbenchArr[i].url.indexOf('homePage/queryHomePage.htm') != -1 ||
								   			loginWorkbenchArr[i].url.indexOf('infoPortal/infoPortal.htm') != -1){
									var hallIndex = i;
								} else if (loginWorkbenchArr[i].url.indexOf('desktop/index.htm') != -1){
									var desktop = i;
								}
							}
							// 设置cookie
							if(hallPageIndex != undefined || moreServicesIndex != undefined || hallIndex != undefined){
								if(tabsActive.url.indexOf('nonlogin/visitor/hallPage.htm') != -1){
									$.cookie("selectedTabsState", hallPageIndex, { path: '/', expires: 0.35 });		
								} else if (tabsActive.url.indexOf('nonlogin/elobby/service/more') != -1){
									$.cookie("selectedTabsState", moreServicesIndex, { path: '/', expires: 0.35 });
								} else if (tabsActive.url.indexOf('homePage/queryHomePage.htm') != -1 ||
										tabsActive.url.indexOf('infoPortal/infoPortal.htm') != -1){
									$.cookie("selectedTabsState", hallIndex, { path: '/', expires: 0.35 });
								} else if (tabsActive.url.indexOf('desktop/index.htm') != -1){
									$.cookie("selectedTabsState", desktop, { path: '/', expires: 0.35 });
								}
							} else {
								$.cookie("selectedTabsState", 0, { path: '/', expires: 0.35 });
							}
						}	
					}
				});
			},1000);
		}

		/**
		 * 功能：miniui-Tabs History
		 * @author wqg
		 * @date 2019-08-05
		 */
		function tabsHistory(tabs) {
			// 获取初始显示页签数
			var tabLength = tabs.tabs.length;
			// 记录头部导航History
        	mini.get("mainTabs").onActiveChanged(function(e) {
                if(e.tab != undefined) {
           			for( var i = 0; i < instTab.length; i++ ) {
           				if( e.tab.url.indexOf(instTab[i].url) != -1 ) {
           					$.cookie("tabsIndex", i, { path: '/', expires: 0.35 });
           				}
           			}
            	}
            });
        	// 获取头部导航History并返回
            mini.get("mainTabs").onCloseClick(function(e){
            	var i = $.cookie("tabsIndex");
            	tabs.removeTab("moreServices");
            	// 如果不是“服务门户”或“信息门户”时需要添加tabs页签并打开
        		if(tabs.tabs.length <= tabLength && /(homePage\/queryHomePage|infoPortal\/infoPortal)\.htm/.test(instTab[i].url) == false){
        			//tabs.addTab(instTab[i]);
        			tabs.activeTab(instTab[i]);
        		}
            });
		}
		</script>
</meta></head>
<body>
<div allowresize="false" class="mini-layout" id="topBox">
<div allowresize="false" height="80px" region="north" showheader="false" showsplit="false" showspliticon="false" splitsize="0" title="north">
<div class="header" style="height:80px">
<a class="login-btn" style="display: none;">登录 / SIGN IN</a>
<div class="header-logo">
<a class="header-menu-btn" onclick="menuCtrl();"></a>
<!--  以下注释代码中放 logo图片 -->
<a class="header-logo-text" href="#">
<img alt="" src="/EIP/core/miniui/themes/2018-skin/2018-img/logo-pic.png" style="height:60px;margin:10px 0;"/>
</a>
</div>
<div class="hall-tabs">
<ul>
<li><a href="javascript:void(0)" style="height:80px;line-height: 80px">首页</a></li>
<li><a href="javascript:void(0)" style="height:80px;line-height: 80px">服务中心</a></li>
<li><a href="javascript:void(0)" style="height:80px;line-height: 80px">个人中心</a></li>
</ul>
</div>
<div class="header-content">
<div class="header-content-personal">
<div class="header-content-personal-avatar">
<img onerror="javascript:this.src='/EIP/core/miniui/themes/2018-skin/2018-img/avatar.jpg';"/>
</div>
<span class="header-content-personal-name no-hover-color"></span>
</div>
<a class="btn-skin" title="切换主题"></a>
<a class="header-content-item header-content-item-onlineuser" href="#" onclick="onMessageBoxXt()" style="position: relative;" title="动态">
<p></p>
<span class="message-xt-flicker" style="display:none; position: absolute; top: 0px; left: 23px;">
<img src="/EIP/core/miniui/themes/2018-skin/2018-img/messageNew.png" style="width: 24px; height: 24px;"/>
</span>
</a>
<a class="header-content-item header-content-item-message" href="#" onclick="onMessageBoxGr()" style="position: relative;" title="个人消息">
<p></p>
<span class="message-gr-flicker" style="display:none; position: absolute; top: 0px; left: 27px;">
<img src="/EIP/core/miniui/themes/2018-skin/2018-img/messageNew.png" style="width: 24px; height: 24px;"/>
</span>
</a>
<!-- <a href="#" class="header-content-item  header-content-item-onlineuser" onclick="onMessageBoxXt()"title="动态"> 
							<p></p>
							<div id="onlineCount"></div>
						</a>  
						 
						<a href="#" class="header-content-item header-content-item-message" onclick="onMessageBoxGr()"title="个人消息"> 
							<p></p>
							<div id="messageCount"></div>
						</a> -->
</div>
<a class="btn-change-language" data-language="en_US" style="display: none;" title="Change language">
						English
					</a>
<div class="header-skin" id="header-skin" style="display: none;">
<!-- <p class="header-skin-title">主题皮肤</p> -->
<div class="triangle"></div>
<div class="btn-toggle-titles">
<span class="btn-toggle-title">透明模式：</span>
<a class="btn-toggle" id="btn-toggle" title="切换UI"></a>
</div>
<ul>
<li class="header-skin-1 img-skin-blue" id="header-skin-1">
<div class="skin-i-selected">使用中</div>
<p class="skin-i-name skin-i-name-blue">靛青</p>
</li>
<li class="header-skin-2 img-skin-purple" id="header-skin-2">
<div class="skin-i-selected">使用中</div>
<p class="skin-i-name skin-i-name-purple">紫丁香</p>
</li>
<li class="header-skin-3 img-skin-green" id="header-skin-3">
<div class="skin-i-selected">使用中</div>
<p class="skin-i-name skin-i-name-green">青葱</p>
</li>
<li class="header-skin-4 img-skin-pink" id="header-skin-4" style="margin-right: 0;">
<div class="skin-i-selected">使用中</div>
<p class="skin-i-name skin-i-name-pink">樱花粉</p>
</li>
<li class="header-skin-5 img-skin-red" id="header-skin-5">
<div class="skin-i-selected">使用中</div>
<p class="skin-i-name skin-i-name-red">殷红</p>
</li>
<li class="header-skin-6 img-skin-lake-blue" id="header-skin-6">
<div class="skin-i-selected">使用中</div>
<p class="skin-i-name skin-i-name-lake-blue">湖蓝</p>
</li>
<li class="header-skin-7 img-skin-pale-green" id="header-skin-7">
<div class="skin-i-selected">使用中</div>
<p class="skin-i-name skin-i-name-pale-green">灰绿</p>
</li>
<li class="header-skin-8 img-skin-pale-blue" id="header-skin-8" style="margin-right: 0;">
<div class="skin-i-selected">使用中</div>
<p class="skin-i-name skin-i-name-pale-blue">灰蓝</p>
</li>
</ul>
</div>
</div>
</div>
<div bodycls="navbj" class="nav" expanded="true" id="west" region="west" showheader="false" showsplit="false" splitsize="0" title="west" visible="false" width="230">
<div class="mini-fit">
<div id="scrollbar">
<div class="mainTree mini-tree" expandonnodeclick="true" id="leftTree" idfield="menuId" onbeforeexpand="onBeforeExpand" onloaderror="onHandleError(e.errorCode);" onnodeclick="onNodeSelect" parentfield="fatherId" resultastree="false" textfield="menuName">
</div>
</div>
</div>
</div>
<!-- content开始 -->
<div class="content" region="center" title="center">
<div activeindex="0" ajaxoptions="{type:'post'}" class="mini-tabs mini-tabs-position" contextmenu="#tabsMenu" id="mainTabs" refreshonclick="true" style="height: 100%;">
</div>
</div>
<!-- content结束 -->
</div>
<ul class="mini-contextmenu" id="tabsMenu" onbeforeopen="onBeforeOpen">
<li iconcls="icon-remove" id="closeThis" onclick="closeTab">关闭标签页</li>
<li iconcls="icon-remove" onclick="closeAllButFirst">关闭其他标签页</li>
<li iconcls="icon-remove" onclick="closeAll">关闭所有标签页</li>
</ul>
<div class="header-message-box" style="display:none;"></div>
<div class="header-online-box" style="display:none;"></div>
<div class="header-admin-box" style="display:none;">
<div class="triangle"></div>
<div class="header-admin-content" id="personal">
<div class="header-admin-onlinezt" id="login-status-box">
<a class="header-admin-onlinezt-inherit onlinezt-online header-admin-onlinezt-online" href="#">在线</a>
<a class="header-admin-onlinezt-inherit onlinezt-busy" href="#">忙碌</a>
<a class="header-admin-onlinezt-inherit onlinezt-invisible" href="#">隐身</a>
<a class="header-admin-onlinezt-inherit onlinezt-offline" href="#">离线</a>
</div>
<div class="header-admin-top">
<p class="header-admin-top-num"></p>
<p class="header-admin-top-num">[]</p>
</div>
<ul class="header-admin-list">
<li id="roleDiv">
<a href="#" onclick="switchRole()">
<img src="/EIP/resources\images\core\role.png"/>
<span>选择角色</span>
</a>
</li>
<li id="personalInfo">
<a href="#" onclick="openPersonalnformation()">
<img src="/EIP/resources\images\core\personal.png"/>
<span>个人信息管理</span>
</a>
</li>
<li>
<a href="#" onclick="groupManagement()">
<img src="/EIP/resources\images\core\group.png"/>
<span>个人群组管理</span>
</a>
</li>
<li>
<a href="#" onclick="onResetPortal(0)">
<img src="/EIP/core/miniui/themes/2018-skin/2018-img/admin-icon-guanli.png"/>
<span>恢复初始桌面</span>
</a>
</li>
<li class="header-exit-box">
<a class="header-exit" href="javascript:void(0);" onclick="logout()" target="_top" title="退出">退出</a>
</li>
</ul>
</div>
</div>
<div allowdrag="true" allowresize="false" class="mini-window" id="messageWindow" showfooter="false" showmaxbutton="false" showmodal="true" showtoolbar="false" style="width:400px;height:250px;" title="发送消息">
<div style="height: 28px;color: #333;line-height: 22px;">
				接收人：<span id="receiver"></span>
<div id="successAlert" style="float:right;padding-right: 3px;display:none;">
<img src="/EIP/message/send-success.png" style="vertical-align:middle;"/> 发送成功
				</div>
<div id="remainArea" style="float:right; padding-right: 3px;">
					(剩余<span id="charRemain">120</span>个字)
				</div>
</div>
<div class="mini-fit" id="messageForm">
<input class="mini-hidden" id="receiverId" name="receiverId"/>
<input class="mini-textarea" emptytext="请输入消息内容" id="messageContent" maxlength="120" name="content" onkeyup="computeRemain();" style="width:100%;height:100%"/>
</div>
<div style="text-align:center;height:30px;line-height:30px;">
<a class="mini-button" iconcls="icon-send-message" id="sendBtn" onclick="sendMessage" plain="true">发送</a>
<span style="display: inline-block; width: 15px;"></span>
<a class="mini-button" iconcls="icon-cancel" onclick="cancel" plain="true">关闭</a>
</div>
</div>
<!-- 此段代码放在后面为修复头像只加载一次或者没加载完就显示页面导致头像位置计算没有生效的BUG -->
<script>
			$(function(){
				imgPosition();
			});
		</script>
</body>
</html>